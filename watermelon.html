<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>西瓜百科全书</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <style>
    /* 全局样式 */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #ffffff;
    }

    /* 网页顶部标题样式 */
    .top-title {
      text-align: center;
      background-color: #c8e6c9;
      padding: 20px 0;
      font-size: 30px;
      color: #e53935;
      font-weight: bold;
    }

    /* 导航栏样式 */
    .navbar {
      height: 60px;
      background-color: #c8e6c9;
      display: flex;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .navbar.back-icon {
      width: 24px;
      height: 24px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23388e3c"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      margin-left: 20px;
      cursor: pointer;
    }

    .navbar.back-icon:hover {
      transform: scale(1.1);
    }

    .navbar.share-icon {
      width: 24px;
      height: 24px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23388e3c"><path d="M17 11.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0zM18 16a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm0-12a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      margin-right: 20px;
      cursor: pointer;
    }

    .navbar.share-icon:hover {
      transform: scale(1.1);
    }

    /* 选择栏样式 */
    .selector {
      display: flex;
      justify-content: center;
      background-color: #e8f5e9;
      padding: 10px 0;
    }

    .selector-item {
      padding: 8px 16px;
      cursor: pointer;
      color: #388e3c;
      margin: 0 10px;
      border-radius: 5px;
    }

    .selector-item:hover {
      background-color: #c8e6c9;
    }

    /* 内容区域样式 */
    .content {
      padding: 20px;
    }

    .content-section,
    .nutrition-section,
    .usage-section,
    .food-recommendation-section,
    .history-section,
    .cultivation-section,
    .quiz-section,
    .program-section {
      display: none;
    }

    /* 标题区域样式 */
    .title-section {
      text-align: center;
      margin: 40px 0;
    }

    .title-section h1 {
      font-size: 30px;
      color: #e53935;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .title-section hr {
      width: 100px;
      height: 2px;
      background-color: #c8e6c9;
      border: none;
      margin: 0 auto;
    }

    /* 内容介绍区域样式 */
    .content-section p {
      font-size: 16px;
      color: #333333;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    /* 营养成分区域样式 */
    .nutrition-section table {
      width: 100%;
      border-collapse: collapse;
    }

    .nutrition-section table th,
    .nutrition-section table td {
      border: 1px solid #c8e6c9;
      padding: 10px;
    }

    .nutrition-section table th {
      background-color: #c8e6c9;
      font-weight: bold;
    }

    .nutrition-section table td {
      font-size: 14px;
      color: #333333;
    }

    /* 食用方法区域样式 */
    .usage-section ul {
      list-style-type: none;
      padding: 0;
    }

    .usage-section ul li {
      font-size: 16px;
      color: #333333;
      margin-bottom: 10px;
      padding-left: 20px;
      position: relative;
    }

    .usage-section ul li:before {
      content: "";
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #388e3c;
      position: absolute;
      left: 0;
      top: 8px;
    }

    /* 美食推荐区域样式 */
    .food-recommendation-section h2 {
      font-size: 20px;
      color: #388e3c;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .food-recommendation-section ul {
      list-style-type: none;
      padding: 0;
    }

    .food-recommendation-section ul li {
      font-size: 16px;
      color: #333333;
      margin-bottom: 10px;
      padding-left: 20px;
      position: relative;
    }

    .food-recommendation-section ul li:before {
      content: "";
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #388e3c;
      position: absolute;
      left: 0;
      top: 8px;
    }

    .user-review {
      border: 1px solid #c8e6c9;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 5px;
    }

    .user-review p {
      font-size: 14px;
      color: #333333;
      margin: 0;
    }

    .user-review span {
      font-size: 12px;
      color: #777777;
      display: block;
      margin-top: 5px;
    }

    /* 西瓜历史区域样式 */
    .history-section h2 {
      font-size: 20px;
      color: #388e3c;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .history-section p {
      font-size: 16px;
      color: #333333;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    /* 培育方法区域样式 */
    .cultivation-section h2 {
      font-size: 20px;
      color: #388e3c;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .cultivation-section p {
      font-size: 16px;
      color: #333333;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    /* 问答游戏区域样式 */
    .quiz-section h2 {
      font-size: 20px;
      color: #388e3c;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .question {
      margin-bottom: 20px;
    }

    .question p {
      font-size: 16px;
      color: #333333;
      margin-bottom: 10px;
    }

    .answer {
      margin-bottom: 5px;
      cursor: pointer;
      padding: 8px 12px;
      border: 1px solid #c8e6c9;
      border-radius: 5px;
      background-color: #f9f9f9;
    }

    .answer:hover {
      background-color: #e8f5e9;
    }

    /* 选中答案的样式 */
    .answer.selected {
      background-color: #c8e6c9;
    }

    /* 底部信息区域样式 */
    .footer {
      background-color: #c8e6c9;
      text-align: center;
      padding: 20px;
      color: #333333;
      font-size: 12px;
      position: relative;
    }

    /* 结果显示区域样式 */
    .result {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #c8e6c9;
      border-radius: 5px;
      background-color: #f9f9f9;
    }

    /* 程序区域样式 */
    .program-section h2 {
      font-size: 20px;
      color: #388e3c;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .program-section p {
      font-size: 16px;
      color: #333333;
      line-height: 1.6;
      margin-bottom: 10px;
    }

    /* 管理员入口按钮样式 */
    .admin-button {
      background-color: #add8e6;
      color: #333333;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      z-index: 100;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      margin-top: 15px;
      display: inline-block;
    }

    .admin-button:hover {
      background-color: #99cfe0;
    }

    /* 管理员面板样式 */
    .admin-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #add8e6;
      padding: 20px;
      box-sizing: border-box;
      display: none;
      z-index: 99;
      box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
      max-height: 300px;
      overflow-y: auto;
    }

    .admin-panel h2 {
      font-size: 20px;
      color: #333333;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .admin-panel table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }

    .admin-panel table th,
    .admin-panel table td {
      border: 1px solid #8ebdd2;
      padding: 8px;
      text-align: center;
    }

    .admin-panel table th {
      background-color: #99cfe0;
      font-weight: bold;
    }

    .admin-panel .button-group {
      display: flex;
      justify-content: space-between;
      margin-top: 15px;
    }

    .admin-panel .exit-button {
      background-color: #f44336;
      color: white;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      display: inline-block;
    }

    .admin-panel .exit-button:hover {
      background-color: #d32f2f;
    }

    .admin-panel .clear-data-button {
      background-color: #ff9800;
      color: white;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      display: inline-block;
    }

    .admin-panel .clear-data-button:hover {
      background-color: #f57c00;
    }

    /* 访客统计区域样式 */
    .visitor-stats {
      margin-top: 20px;
      padding: 15px;
      background-color: #e8f5e9;
      border-radius: 5px;
    }

    .visitor-stats h3 {
      font-size: 16px;
      color: #388e3c;
      margin-bottom: 10px;
    }

    .visitor-stats p {
      margin: 5px 0;
    }

    /* 确认对话框样式 */
    .confirmation-dialog {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      display: none;
    }

    .dialog-content {
      background-color: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      max-width: 300px;
      width: 90%;
    }

    .dialog-content h3 {
      margin-top: 0;
      margin-bottom: 15px;
    }

    .dialog-buttons {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .dialog-buttons button {
      margin-left: 10px;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .dialog-buttons .confirm-button {
      background-color: #f44336;
      color: white;
    }

    .dialog-buttons .cancel-button {
      background-color: #e0e0e0;
    }
  </style>
</head>

<body>
  <!-- 网页顶部标题 -->
  <div class="top-title">西瓜百科全书</div>

  <!-- 导航栏 -->
  <div class="navbar">
    <div class="back-icon"></div>
    <div class="share-icon"></div>
  </div>

  <!-- 选择栏 -->
  <div class="selector">
    <div class="selector-item" data-target="all">全部</div>
    <div class="selector-item" data-target="intro">西瓜介绍</div>
    <div class="selector-item" data-target="food">西瓜美食</div>
    <div class="selector-item" data-target="history">西瓜历史</div>
    <div class="selector-item" data-target="cultivation">培育方法</div>
    <div class="selector-item" data-target="quiz">问答游戏</div>
    <div class="selector-item" data-target="program">西瓜百科全书程序</div>
  </div>

  <!-- 内容区域 -->
  <div class="content">
    <!-- 标题区域 -->
    <div class="title-section">
      <h1>夏日消暑圣品——西瓜</h1>
      <hr>
    </div>

    <!-- 内容介绍区域 -->
    <div class="content-section" data-group="intro">
      <p>西瓜原产于非洲，早在四千年前，埃及人就已经开始种植西瓜，并将其作为重要的水果之一。随着时间的推移，西瓜逐渐传播到世界各地，成为了人们喜爱的夏季水果。</p>
      <p>西瓜的果实多汁，味道甜美，其外皮通常为绿色，带有深浅不一的条纹，果肉则多为红色或黄色，口感脆嫩，是消暑解渴的佳品。</p>
    </div>

    <!-- 营养成分区域 -->
    <div class="nutrition-section" data-group="intro">
      <table>
        <thead>
          <tr>
            <th>营养成分</th>
            <th>含量</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>维生素C</td>
            <td>约 9.0 毫克/100 克</td>
          </tr>
          <tr>
            <td>维生素B6</td>
            <td>约 0.1 毫克/100 克</td>
          </tr>
          <tr>
            <td>钾</td>
            <td>约 104 毫克/100 克</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 食用方法区域 -->
    <div class="usage-section" data-group="intro">
      <ul>
        <li>直接食用：将西瓜洗净，切成块状或片状，即可享用其清甜的口感。</li>
        <li>制作饮品：可以将西瓜榨汁，加入适量的蜂蜜或柠檬汁，制成美味的西瓜汁。</li>
        <li>制作甜点：西瓜可以用来制作西瓜冰淇淋、西瓜果冻等甜点，增添别样的风味。</li>
      </ul>
    </div>

    <!-- 美食推荐区域 -->
    <div class="food-recommendation-section" data-group="food">
      <h2>西瓜相关美食推荐</h2>
      <ul>
        <li>西瓜薄荷沙拉：西瓜块搭配新鲜薄荷、奶酪和坚果，清爽又美味。</li>
        <li>西瓜西米露：西瓜汁与煮好的西米混合，再加入椰奶，香甜可口。</li>
        <li>西瓜披萨：在披萨饼上铺上西瓜片、火腿和芝士，烤制出独特的风味。</li>
      </ul>
      <h2>用户评价</h2>
      <div class="user-review">
        <p>超爱西瓜！夏天每天都要吃，水分足又甜，解渴又消暑。</p>
        <span>——西瓜小吴，2018年8月8日</span>
      </div>
      <div class="user-review">
        <p>用西瓜做了西瓜冰沙，家里人都很喜欢，以后要尝试更多西瓜美食。</p>
        <span>——过期蜂蜜水，2018年8月18日</span>
      </div>
    </div>

    <!-- 西瓜历史区域 -->
    <div class="history-section" data-group="history">
      <h2>西瓜的历史</h2>
      <p>西瓜的种植历史可以追溯到数千年前的非洲东北部。考古学家在埃及古墓壁画中发现了西瓜的图案，这表明早在公元前 2000 年左右，埃及人就已经开始种植和食用西瓜。随着贸易和文化的交流，西瓜逐渐传播到地中海地区、中东和印度。</p>
      <p>大约在唐朝时期，西瓜经丝绸之路传入中国，当时被称为“寒瓜”或者“夏瓜”。到了宋代，西瓜在中国得到了广泛种植和普及，成为了夏季消暑的常见水果。此后，西瓜又从中国传播到了朝鲜、日本等亚洲国家。</p>
      <p>在 16 世纪，欧洲殖民者将西瓜带到了美洲大陆。如今，西瓜已经在全球范围内广泛种植，成为了人们喜爱的夏季水果之一。</p>
    </div>

    <!-- 培育方法区域 -->
    <div class="cultivation-section" data-group="cultivation">
      <h2>西瓜的培育方法</h2>
      <p>1. **选地整地**：选择地势高、排水良好、土层深厚、肥沃疏松的砂质壤土。在种植前，要进行深耕细耙，并施足基肥，一般每亩施入有机肥 3000 - 5000 公斤、过磷酸钙 50 公斤、硫酸钾 20 公斤。</p>
      <p>2. **品种选择**：根据当地的气候条件、市场需求和栽培方式，选择适宜的西瓜品种。常见的品种有京欣一号、黑美人、早春红玉等。</p>
      <p>3. **播种育苗**：西瓜可以采用直播或育苗移栽的方式。直播一般在当地终霜期过后进行，育苗移栽则可以提前在温室或大棚内进行育苗，待幼苗长到 3 - 4 片真叶时，再移栽到田间。</p>
      <p>4. **田间管理**：在西瓜生长期间，要及时进行中耕除草、追肥、浇水、整枝打杈等管理工作。同时，要注意防治病虫害，确保西瓜的正常生长。</p>
      <p>5. **收获**：西瓜的收获时间要根据品种、栽培方式和市场需求来确定。一般来说，早熟品种在开花后 28 - 30 天左右成熟，中熟品种在开花后 32 - 35 天左右成熟，晚熟品种在开花后 35 - 40 天左右成熟。</p>
    </div>

    <!-- 问答游戏区域 -->
    <div class="quiz-section" data-group="quiz">
      <h2>西瓜知识问答游戏</h2>
      <div class="question">
        <p>西瓜原产于哪个大洲？</p>
        <div class="answer" data-correct="false">亚洲</div>
        <div class="answer" data-correct="true">非洲</div>
        <div class="answer" data-correct="false">欧洲</div>
      </div>
      <div class="question">
        <p>西瓜传入中国大约是在哪个朝代？</p>
        <div class="answer" data-correct="false">汉朝</div>
        <div class="answer" data-correct="true">唐朝</div>
        <div class="answer" data-correct="false">宋朝</div>
      </div>
      <div class="question">
        <p>西瓜最常见的果肉颜色是什么？</p>
        <div class="answer" data-correct="false">黄色</div>
        <div class="answer" data-correct="true">红色</div>
        <div class="answer" data-correct="false">绿色</div>
      </div>
      <div class="question">
        <p>以下哪种不是西瓜的食用方法？</p>
        <div class="answer" data-correct="false">直接食用</div>
        <div class="answer" data-correct="false">制作饮品</div>
        <div class="answer" data-correct="true">腌制咸菜</div>
      </div>
      <div class="question">
        <p>西瓜在种植时适宜的土壤类型是？</p>
        <div class="answer" data-correct="false">黏土</div>
        <div class="answer" data-correct="true">砂质壤土</div>
        <div class="answer" data-correct="false">盐碱土</div>
      </div>
      <div class="question">
        <p>西瓜的哪个营养成分含量相对较高？</p>
        <div class="answer" data-correct="false">蛋白质</div>
        <div class="answer" data-correct="true">维生素C</div>
        <div class="answer" data-correct="false">脂肪</div>
      </div>
      <div class="question">
        <p>以下哪个名称在古代不代表西瓜？</p>
        <div class="answer" data-correct="true">冬瓜</div>
        <div class="answer" data-correct="false">夏瓜</div>
        <div class="answer" data-correct="false">寒瓜</div>
      </div>
      <div class="question">
        <p>西瓜在哪个世纪被欧洲殖民者带到美洲大陆？</p>
        <div class="answer" data-correct="false">15世纪</div>
        <div class="answer" data-correct="true">16世纪</div>
        <div class="answer" data-correct="false">17世纪</div>
      </div>
      <div class="result" id="result"></div>
    </div>

    <!-- 西瓜百科全书程序区域 -->
    <div class="program-section" data-group="program">
      <h2>西瓜百科全书程序资源</h2>
      <p>
        <section class="download-section" data-group="resource">
          <div class="download-button-container">
            直接下载：
            <a href="watermelon-code.zip" download class="download-button">
              <i class="fa fa-download"></i> 西瓜百科全书代码
            </a>
          </div>
        </section>
      </p>
      <p>Gitbub链接：https://github.com/wujc888/watermelon</p>
      <p>百度网盘链接：https://pan.baidu.com/s/1YXKNHkhcAtbanCyCSdEfcQ</p>
      <p>提取码：xgxw</p>
    </div>
  </div>

  <!-- 底部信息区域 -->
  <div class="footer">
    &copy; 2025 版权所有 | 联系我们：xi_gua888@126.com
    <br>
    版本号：v1.0.8
    
    <!-- 管理员入口按钮 -->
    <div class="admin-button" id="adminButton">管理员入口</div>
    
    <!-- 访客统计 -->
    <div class="visitor-stats">
      <h3>访客统计</h3>
      <p>今日访问量：<span id="today-visits">0</span></p>
      <p>本周访问量：<span id="week-visits">0</span></p>
      <p>总访问量：<span id="total-visits">0</span></p>
    </div>
  </div>

  <!-- 管理员面板 -->
  <div class="admin-panel" id="adminPanel">
    <h2>网站用户统计</h2>
    <table>
      <thead>
        <tr>
          <th>访问日期</th>
          <th>访问时间</th>
          <th>IP地址</th>
          <th>访问页面</th>
        </tr>
      </thead>
      <tbody id="visitor-table-body">
        <!-- 数据将通过JavaScript动态填充 -->
      </tbody>
    </table>
    <div class="button-group">
      <div class="clear-data-button" id="clearDataButton">清空数据</div>
      <div class="exit-button" id="exitButton">退出管理</div>
    </div>
  </div>

  <!-- 确认对话框 -->
  <div class="confirmation-dialog" id="confirmationDialog">
    <div class="dialog-content">
      <h3>确认清空数据</h3>
      <p>你确定要清空所有访问记录吗？此操作不可撤销。</p>
      <div class="dialog-buttons">
        <button class="cancel-button" id="cancelButton">取消</button>
        <button class="confirm-button" id="confirmButton">确认</button>
      </div>
    </div>
  </div>

  <script>
    const selectorItems = document.querySelectorAll('.selector-item');
    const contentSections = document.querySelectorAll('.content-section, .nutrition-section, .usage-section, .food-recommendation-section, .history-section, .cultivation-section, .quiz-section, .program-section');
    const adminButton = document.getElementById('adminButton');
    const adminPanel = document.getElementById('adminPanel');
    const exitButton = document.getElementById('exitButton');
    const clearDataButton = document.getElementById('clearDataButton');
    const confirmationDialog = document.getElementById('confirmationDialog');
    const confirmButton = document.getElementById('confirmButton');
    const cancelButton = document.getElementById('cancelButton');
    
    // 本地存储键名
    const STORAGE_KEYS = {
      VISITOR_LOGS: 'watermelon_visitor_logs',
      VISITOR_STATS: 'watermelon_visitor_stats',
      TODAY_DATE: 'watermelon_today_date',
      WEEK_START_DATE: 'watermelon_week_start_date'
    };
    
    // 页面加载时初始化
    window.addEventListener('load', () => {
      const allItem = document.querySelector('.selector-item[data-target="all"]');
      allItem.click();
      
      // 初始化访问统计
      initVisitorStats();
      
      // 记录用户访问
      logUserVisit();
      
      // 加载并显示访问记录
      loadVisitorLogs();
    });

    // 内容选择器逻辑
    selectorItems.forEach(item => {
      item.addEventListener('click', function () {
        const target = this.dataset.target;

        contentSections.forEach(section => {
          if (target === 'all') {
            section.style.display = 'block';
          } else {
            section.style.display = section.dataset.group === target? 'block' : 'none';
          }
        });
        
        // 移除所有选中状态
        selectorItems.forEach(i => i.classList.remove('selected'));
        // 添加当前选中状态
        this.classList.add('selected');
        
        // 记录用户访问
        logUserVisit();
      });
    });

    // 问答游戏逻辑
    const questions = document.querySelectorAll('.question');
    const resultDiv = document.getElementById('result');
    const selectedAnswers = [];

    questions.forEach((question, index) => {
      const answers = question.querySelectorAll('.answer');
      answers.forEach(answer => {
        answer.addEventListener('click', function () {
          // 移除同一问题下其他选项的选中样式
          answers.forEach(ans => ans.classList.remove('selected'));
          // 添加当前选中选项的样式
          this.classList.add('selected');
          selectedAnswers[index] = this.dataset.correct === 'true';
          checkAllAnswered();
        });
      });
    });

    function checkAllAnswered() {
      if (selectedAnswers.length === questions.length) {
        const correctCount = selectedAnswers.filter(answer => answer).length;
        const incorrectCount = selectedAnswers.length - correctCount;
        resultDiv.innerHTML = `你答对了 ${correctCount} 道题，答错了 ${incorrectCount} 道题。`;
      }
    }

    // 管理员入口交互
    adminButton.addEventListener('click', () => {
      adminPanel.style.display = 'block';
      adminButton.style.display = 'none';
    });

    exitButton.addEventListener('click', () => {
      adminPanel.style.display = 'none';
      adminButton.style.display = 'block';
    });

    // 清空数据确认对话框
    clearDataButton.addEventListener('click', () => {
      confirmationDialog.style.display = 'flex';
    });

    cancelButton.addEventListener('click', () => {
      confirmationDialog.style.display = 'none';
    });

    confirmButton.addEventListener('click', () => {
      // 清空访问记录
      localStorage.removeItem(STORAGE_KEYS.VISITOR_LOGS);
      
      // 重置统计数据
      const initialStats = {
        today: 0,
        week: 0,
        total: 0
      };
      localStorage.setItem(STORAGE_KEYS.VISITOR_STATS, JSON.stringify(initialStats));
      
      // 刷新表格
      document.getElementById('visitor-table-body').innerHTML = '';
      
      // 更新统计显示
      updateVisitorStatsDisplay(initialStats);
      
      // 关闭对话框
      confirmationDialog.style.display = 'none';
    });

    // 初始化访问统计
    function initVisitorStats() {
      const today = new Date().toISOString().split('T')[0];
      const storedTodayDate = localStorage.getItem(STORAGE_KEYS.TODAY_DATE);
      
      // 获取统计数据
      let stats = JSON.parse(localStorage.getItem(STORAGE_KEYS.VISITOR_STATS));
      
      // 如果是新的一天，重置今日统计
      if (today !== storedTodayDate) {
        if (!stats) {
          stats = {
            today: 0,
            week: 0,
            total: 0
          };
        } else {
          stats.today = 0;
        }
        
        localStorage.setItem(STORAGE_KEYS.TODAY_DATE, today);
      }
      
      // 如果没有统计数据，初始化
      if (!stats) {
        stats = {
          today: 0,
          week: 0,
          total: 0
        };
        localStorage.setItem(STORAGE_KEYS.VISITOR_STATS, JSON.stringify(stats));
      }
      
      // 更新显示
      updateVisitorStatsDisplay(stats);
    }

    // 记录用户访问
    function logUserVisit() {
      // 获取当前日期和时间
      const now = new Date();
      const date = now.toISOString().split('T')[0];
      const time = now.toTimeString().split(' ')[0];
      
      // 获取当前页面
      const currentPage = document.querySelector('.selector-item.selected')?.textContent || '全部';
      
      // 生成一个模拟IP地址
      const ip = `192.168.1.${Math.floor(Math.random() * 255)}`;
      
      // 创建访问记录
      const visitRecord = {
        date,
        time,
        ip,
        page: currentPage
      };
      
      // 保存到本地存储
      const logs = JSON.parse(localStorage.getItem(STORAGE_KEYS.VISITOR_LOGS)) || [];
      logs.unshift(visitRecord);
      
      // 只保留最近的100条记录
      if (logs.length > 100) {
        logs.splice(100);
      }
      
      localStorage.setItem(STORAGE_KEYS.VISITOR_LOGS, JSON.stringify(logs));
      
      // 更新统计
      updateStats();
      
      // 刷新表格显示
      loadVisitorLogs();
    }

    // 更新统计数据
    function updateStats() {
      const today = new Date().toISOString().split('T')[0];
      const logs = JSON.parse(localStorage.getItem(STORAGE_KEYS.VISITOR_LOGS)) || [];
      
      // 获取统计数据
      let stats = JSON.parse(localStorage.getItem(STORAGE_KEYS.VISITOR_STATS)) || {
        today: 0,
        week: 0,
        total: 0
      };
      
      // 更新今日访问量
      stats.today = logs.filter(log => log.date === today).length;
      
      // 更新本周访问量（过去7天）
      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      const weekAgoDate = weekAgo.toISOString().split('T')[0];
      
      stats.week = logs.filter(log => {
        return new Date(log.date) >= new Date(weekAgoDate);
      }).length;
      
      // 更新总访问量
      stats.total = logs.length;
      
      // 保存统计数据
      localStorage.setItem(STORAGE_KEYS.VISITOR_STATS, JSON.stringify(stats));
      
      // 更新显示
      updateVisitorStatsDisplay(stats);
    }

    // 更新统计显示
    function updateVisitorStatsDisplay(stats) {
      document.getElementById('today-visits').textContent = stats.today;
      document.getElementById('week-visits').textContent = stats.week;
      document.getElementById('total-visits').textContent = stats.total.toLocaleString();
    }

    // 加载并显示访问记录
    function loadVisitorLogs() {
      const logs = JSON.parse(localStorage.getItem(STORAGE_KEYS.VISITOR_LOGS)) || [];
      const tableBody = document.getElementById('visitor-table-body');
      
      // 清空表格
      tableBody.innerHTML = '';
      
      // 如果没有记录，显示空消息
      if (logs.length === 0) {
        const emptyRow = document.createElement('tr');
        emptyRow.innerHTML = `<td colspan="4">暂无访问记录</td>`;
        tableBody.appendChild(emptyRow);
        return;
      }
      
      // 添加记录到表格
      logs.forEach(log => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${log.date}</td>
          <td>${log.time}</td>
          <td>${log.ip}</td>
          <td>${log.page}</td>
        `;
        tableBody.appendChild(row);
      });
    }
  </script>
</body>

</html>
  
